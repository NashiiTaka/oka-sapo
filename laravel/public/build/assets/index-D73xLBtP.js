const v={message:"こんにちは！どの種類の家電製品についてお手伝いさせていただけますか？",options:["その他","キッチン家電","洗濯家電","家庭エンターテイメント","冷暖房家電","小型家電","パーソナルケア","コンピュータ/タブレット/スマートフォン","ガジェット"],multiple:!1,etcCustomeDisp:"入力して指定"};let l=0,u="";$(document).ready(function(){function h(e,n){return n.html(""),new Promise(r=>{let t=0;function i(){t<e.length&&(n.html(e.substring(0,t+1)+(t<e.length-1?"●":"")),t++,t<e.length?setTimeout(i,30):r())}i()})}function s(e){if(l++,$(`#chat-${l}`).removeClass("hidden"),typeof e=="object")b(e);else{const n=new FormData;n.append("message",e),n.append("thread_id",u),console.log("post message:"+e),axios.post("./passer",n,{timeout:1e4}).then(function(r){var i,a;const t=(i=r.data)!=null&&i.value?(a=r.data)==null?void 0:a.value:r.data;console.log(t),u||(u=t.thread_id,history.replaceState(null,null,"?tid="+encodeURIComponent(u))),b(t)}).catch(function(r){console.error(r)})}}function b(e){const n=$("#chat-area"),r=$("#chat-template").html().replace(/chatno/g,l+1);n.append(r),h(e.message,$(`#bot-${l}`)).then(()=>{const t=e.etcCustomeDisp;if($(`#you-wrap-${l}`).removeClass("hidden"),e.options&&e.options.length>0){const i=$(`#you-${l}`);if(e.options.some(a=>a.match(/その他/))||e.options.push("その他"),e.multiple){const a=$(`<ul class="flex flex-col" id="ul-${l}"></ul>`);i.append(a);const d=e.options.map((c,o)=>`
              <li class="inline-flex items-center gap-x-2.5 pl-4 text-sm font-medium bg-white border text-gray-800 -mt-px first:rounded-t-lg first:mt-0 last:rounded-b-lg dark:bg-neutral-800 dark:border-neutral-700 dark:text-white">
                <div class="relative flex items-start w-full">
                  <div class="flex items-center py-3">
                    <input
                      type="checkbox"
                      id="chb-${l}-${o}"
                      name="chb-${l}[]"
                      value="${c}"
                      class="shrink-0 border-gray-200 rounded text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800"
                    >
                  </div>
                  <label
                    for="chb-${l}-${o}"
                    class="block w-full pl-2 py-3 text-sm text-gray-600 dark:text-neutral-500"
                  >
                    ${c}
                  </label>
                </div>
              </li>`),p=`btn-chb-ok-${l}`;g(d,a).then(()=>{i.append(`<div class="w-full flex justify-center items-center pt-2">  <input type="submit" id="${p}" class="py-1 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none" value="OK" /></div>`),$(`#${p}`).on("click",c=>{c.preventDefault();var o=[];$(`#ul-${l} input[type="checkbox"]:checked`).each(function(){o.push($(this).val())}),o.length?($(`#${p}`).remove(),$(`#ul-${l} input[type="checkbox"]`).on("click",function(y){y.preventDefault()}),s(o.join(","))):alert("選択して下さい。")})})}else{const a=e.options.map(d=>`<div class="btns-${l}${d.match(/その他/)?" btn-etc":""} cursor-pointer w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800">
  ${d.match(/その他/)?t||"なんでも聞いて下さい":d}
</div>`);x(a,i)}}else{const i=`btn-free-input-${l}`,a=`btn-free-ok-${l}`;$(`#you-${l}`).html(m(i,a)),$(`#${a}`).on("click",k),$(`${i}`).focus()}})}function g(e,n){return new Promise(r=>{let t=0;function i(){t<e.length?setTimeout(()=>{n.append(e[t++]),t<e.length?i():r()},120):r()}i()})}function x(e,n){let r=0;function t(){r<e.length&&setTimeout(()=>{n.append(e[r++]),r<e.length?t():$(`.btns-${l}`).on("click",f)},120)}t()}function f(e){const n=$(e.target),r=`btn-etc-input-${l}`,t=`btn-etc-ok-${l}`;n.hasClass("btn-etc")?(n.off("click"),n.html(m(r,t)),$(`#${r}`).focus(),$(`#${t}`).on("click",i=>{i.preventDefault();const a=$(`#${r}`).val();n.html(a||"なんでも聞いて下さい"),a?(e.target.className="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none",$(`.btns-${l}`).off("click"),s(a)):setTimeout(()=>n.on("click",f),0)})):($(`.btns-${l}`).off("click"),$(`#${r}`).attr("disabled",!0).addClass("bg-gray-300 cursor-not-allowed"),$(`#${t}`).remove(),e.target.className="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none",s($(e.target).html().trim()))}function k(e){e.preventDefault();const n=$(e.target),t=n.siblings("input")[0].value.trim();t?(n.parentsUntil("div").html(`<div class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
          ${t}
        </div>`),s(t)):alert("入力して下さい")}function m(e,n){return`<form class="flex w-full"><input type="text" id="${e}" class="peer py-1 pe-0 block w-full bg-transparent border-t-transparent border-b-2 border-x-transparent border-b-gray-200 focus:border-t-transparent focus:border-x-transparent focus:border-b-blue-500 focus:ring-0 disabled:opacity-50 disabled:pointer-events-none dark:border-b-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600 dark:focus:border-b-neutral-600" placeholder="入力して下さい"><input type="submit" id="${n}" class="py-1 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none" value="OK" /></form>`}s(v)});
